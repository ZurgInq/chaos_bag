<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Random Bag</title>
</head>

<style>
    .flip {
        transform: rotateY(720deg);
        animation: rotate 2s ease-in-out;
    }

    @keyframes rotate {
        100% {
            transform: none;
        }
    }
</style>

<body>
    <div class="container">
        <div style="text-align: center;">
            <h1>Мешок случайности</h1>
            <select id="bagSelector" class="form-select">
                <option disabled="disabled">Сложность мешка</option>
                <option selected value="easy">Лёгкий мешок</option>
                <option value="normal">Нормальный мешок</option>
              </select>
            <button style="margin: 10px;" type="button" class="btn btn-primary" onclick="randomToken()">Вытащить жетон</button>
            <p style="margin: 10px;"><img class="" data-token onclick="randomToken()" src=""></p>
            <!-- <p>Значения в мешке: </p> -->
            <p id="bagContent"></p>
        </div>
    </div>
</body>
<script>
    const easyBag = [
        'p1',
        'p1',
        '0',
        '0',
        '0',
        'm1',
        'm1',
        'm1',
        'm2',
        'm2',
        'skull',
        'skull',
        'cultist',
        'mirror',
        'doom',
        'special',
    ];

    const normalBag = [
        'p1',
        '0',
        '0',
        'm1',
        'm1',
        'm1',
        'm2',
        'm2',
        'm3',
        'm4',
        'skull',
        'skull',
        'cultist',
        'mirror',
        'doom',
        'special',
    ];

    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min)) + min; //Максимум не включается, минимум включается
    }

    let tokenRotated = false;

    const bagSelector = document.getElementById('bagSelector');

    function updateTokenImg(value) {
        document.querySelector('img[data-token]').setAttribute('src', 'assets/' + value + '.png');
    }

    function randomToken() {
        if (tokenRotated) {
            return;
        }
        let selectedBag;

        switch (bagSelector.value) {
            case 'easy': {
                selectedBag = easyBag;
                break;
            }
            case 'normal': {
                selectedBag = normalBag;
                break;
            }
            default: {
                throw 'invalid bagSelector value';
            }
        }

        // document.getElementById('bagContent').innerText = selectedBag;

        const tokenValue = getRandomInt(0, 16);
        const tokenImg = document.querySelector('img[data-token]');

        if (tokenImg.getAttribute('src') === '') {
            updateTokenImg(selectedBag[tokenValue]);
            return;
        }

        tokenRotated = true;
        tokenImg.classList.add('flip');
        setTimeout(()=> {
            updateTokenImg(selectedBag[tokenValue]);
            tokenImg.classList.remove('flip');
            tokenRotated = false;
        }, 2000);
    }
</script>

</html>